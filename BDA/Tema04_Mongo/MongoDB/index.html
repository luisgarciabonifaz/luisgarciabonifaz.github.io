
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.8">
    
    
      
        <title>3. MongoDB - Mis Clases</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.046329b4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3-mongodb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Mis Clases" class="md-header__button md-logo" aria-label="Mis Clases" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mis Clases
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. MongoDB
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Mis Clases" class="md-nav__button md-logo" aria-label="Mis Clases" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Mis Clases
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sistemes Operatius Monolloc
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Sistemes Operatius Monolloc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema01/SistemesInformatics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T1 - Sistemes Informàtics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema02/SistemesOperatius/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T2 - Sistemes Operatius
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema03/GestionRecursos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T3 - Gestión de Recursos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema04/Virtualitzacio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T4 - Virtualització
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema05/InstalacionSO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T5 - Instalació Sistemes Operatius
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema06/ConfiguracionBasicaWindows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T6 - Configuració bàsica Windows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema07/FicherosDirectoriosWindows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T7 - Gestió de fitxers i directoris en Windows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema08/UsuariosGruposWindows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T8 - Gestió de usuaris i grups en Windows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema09/AdministracionWindows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T9 - Administració del Sistema en Windows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema10/IntroduccionLinux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T10 - Introducción Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema11/ArchivosLinux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T11 - Gestión de archivos en Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema12/Usuarios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T12 - Gestión de usurarios en Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SOM/Tema13/Administracion_Linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T13 - Administración en Linux
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sistemas Big Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Sistemas Big Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema01/BigDataConAWS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T1 - Big Data con AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema02/InfraestructuraAWS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T2 - Infraestructura AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema03/SeguridadAWS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T3 - Seguridad en AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema04/Informatica/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T4 - Informatica en AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema05/AlmacenamientoAWS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T5 - Almacenamiento en AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema06/BasesDatos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T6 - Bases de Datos AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema07/AWS_Glue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T7 - AWS Glue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema08/Kinesis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T8 - AWS Kinesis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../SBD/Tema01/PracticasAWS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T12 - AWS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Big Data Aplicado
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Big Data Aplicado
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema00/Infraestructura/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T0 - Infraestrucura Big Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema01/IntroduccionBigData.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T1 - Introducción Big Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema02/RepasoSQL.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T2 - Repaso SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema03/NoSQL.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T3 - Bases de datos NoSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema04/MongoDB.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T4 - MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema05/Almacenamiento.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T5 - Almacenamiento
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema06/ETL.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T6 - ETL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema07/BI.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T7 - Bussines Intelligence
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Power BI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Power BI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T1 - Introducción Power BI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T2 - Instalación y configuración de Power BI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T3 - Conectando datos a Power BI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T4 - Transformación y limpieza de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T5 - Modelado de datos en Power BI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema06/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T6 - Creación de visualizaciones básicas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema07/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T7 - Creación de informes interactivos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema08/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T8 - Compartir y colaborar en Power BI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../PowerBI/Tema09/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T9 - Actualización de datos y programación de actualizaciones
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#31-conceptos-basicos" class="md-nav__link">
    3.1. Conceptos Básicos
  </a>
  
    <nav class="md-nav" aria-label="3.1. Conceptos Básicos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311-documentos" class="md-nav__link">
    3.1.1. Documentos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312-colecciones" class="md-nav__link">
    3.1.2. Colecciones
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#32-operaciones-basicas" class="md-nav__link">
    3.2. Operaciones básicas
  </a>
  
    <nav class="md-nav" aria-label="3.2. Operaciones básicas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-insercion" class="md-nav__link">
    3.2.1. Inserción
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322-borrado" class="md-nav__link">
    3.2.2. Borrado
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323-modificacion" class="md-nav__link">
    3.2.3. Modificación
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#33-consultas" class="md-nav__link">
    3.3. Consultas
  </a>
  
    <nav class="md-nav" aria-label="3.3. Consultas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331-operadores-de-comparacion" class="md-nav__link">
    3.3.1 Operadores de comparación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332-operadores-logicos" class="md-nav__link">
    3.3.2. Operadores lógicos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333-busqueda-de-texto" class="md-nav__link">
    3.3.3. Búsqueda de texto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#334-consultas-con-arrays" class="md-nav__link">
    3.3.4. Consultas con Arrays
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#335-documentos-embebidos" class="md-nav__link">
    3.3.5. Documentos embebidos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#34-cursores" class="md-nav__link">
    3.4. Cursores
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#35-agregacion" class="md-nav__link">
    3.5. Agregación
  </a>
  
    <nav class="md-nav" aria-label="3.5. Agregación">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#351-operadores-del-pipeline" class="md-nav__link">
    3.5.1. Operadores del pipeline
  </a>
  
    <nav class="md-nav" aria-label="3.5.1. Operadores del pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3511-operador-match" class="md-nav__link">
    3.5.1.1. Operador $match
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3512-operador-project" class="md-nav__link">
    3.5.1.2. Operador $project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3513-operador-group" class="md-nav__link">
    3.5.1.3. Operador $group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3514-expresiones-en-el-pipeline" class="md-nav__link">
    3.5.1.4. Expresiones en el Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3515-operador-sort" class="md-nav__link">
    3.5.1.5. Operador $sort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3516-operador-limit" class="md-nav__link">
    3.5.1.6. Operador $limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3517-operador-skip" class="md-nav__link">
    3.5.1.7. Operador $skip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3518-operador-unwind" class="md-nav__link">
    3.5.1.8. operador $unwind
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3519-operador-lookup" class="md-nav__link">
    3.5.1.9. operador $lookup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#36-actividades" class="md-nav__link">
    3.6. Actividades
  </a>
  
    <nav class="md-nav" aria-label="3.6. Actividades">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#361-act_1" class="md-nav__link">
    3.6.1. Act_1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#362-act_2" class="md-nav__link">
    3.6.2. Act_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#363-act_3" class="md-nav__link">
    3.6.3. Act_3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#364-act_4" class="md-nav__link">
    3.6.4. Act_4
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="3-mongodb">3. MongoDB</h1>
<h2 id="31-conceptos-basicos">3.1. Conceptos Básicos</h2>
<p>Los elementos de MongoDB son:</p>
<ul>
<li><strong>Bases de Datos</strong>: Actúa cada una como un contenedor de alto nivel</li>
<li><strong>Colecciones</strong>: Una base de datos tendrá 0 o más colecciones. Una colección es muy similar a lo que entendemos como tabla dentro de un SGDB.</li>
<li><strong>Documentos</strong>: Las colecciones contiene 0 o más documentos, por lo que es similar a una fila o registro de un RDMS.</li>
</ul>
<p><img alt="Esquema MongoDB" src="../EsquemaDocumentos.png" style="width:50%;margin:auto;display:block" /></p>
<h3 id="311-documentos">3.1.1. Documentos</h3>
<p>El corazón de MongoDB es el documento, un conjunto ordenado de claves con valores asociados. Su representación como hemos nombrado en el tema anterior es en JSON, un formato muy intuitivo y que no pensamos que requiera mayor explicación. Este podría ser un ejemplo sencillo de un documento que guarda el nombre, apellidos y dedad de una persona. A la izquierda de los dos puntos el nombre del campo y a la derecha el valor.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">{</span>
<span class="w">  </span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="s2">&quot;Jose Antonio&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="err">apellidos</span><span class="p">:</span><span class="s2">&quot;Guillem Benedito&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="err">edad</span><span class="p">:</span><span class="mi">35</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>Las claves de los documentos:</p>
<ul>
<li>No pueden ser nulas.</li>
<li>No pueden contener los caracteres . (punto) y $ (dólar).</li>
<li>Puede contener cualquiera de los demás caracteres UTF-8 existentes.</li>
<li>Son case-sensitive (sensible a mayúsculas y minúsculas), por lo que las claves “nombre” y “Nombre” son diferentes, y por tanto consideradas como campos diferentes.</li>
<li>Las claves dentro de un mismo documento deben ser únicas, no pueden duplicarse. Así por ejemplo el siguiente documento no es válido por tener dos veces la clave nota.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">{</span>
<span class="w">  </span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="s2">&quot;Jose Antonio&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="kc">n</span><span class="err">o</span><span class="kc">ta</span><span class="p">:</span><span class="mf">8.9</span><span class="p">,</span>
<span class="w">  </span><span class="kc">n</span><span class="err">o</span><span class="kc">ta</span><span class="p">:</span><span class="mf">7.2</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>Cada documento en Mongo debe tener <strong>obligatoriamente</strong> un campo _id con valor único y que actuará como identificador único del documento. Es tan necesario este campo que cuando se guarda un documento sin especificarlo, Mongo automáticamente le asigna uno del tipo ObjectId.</p>
<h3 id="312-colecciones">3.1.2. Colecciones</h3>
<p>Una colección es un grupo de documentos, es lo análogo a las tablas en el modelo relacional.
Las colecciones tienen esquemas dinámicos, lo que significa que los documentos dentro de una colección pueden tener múltiples “formas”. Por ejemplo, los siguientes documentos podrían guardarse en la misma colección, a pesar de tener diferentes campos, y diferentes tipos de datos.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="s2">&quot;Jose Antonio&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">edad</span><span class="p">:</span><span class="mi">35</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="err">user</span><span class="kc">na</span><span class="err">me</span><span class="p">::</span><span class="s2">&quot;pepito&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="err">ac</span><span class="kc">t</span><span class="err">ive</span><span class="p">:</span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></p>
<p>Hay algunas restricciones respecto al nombre que una colección puede tener:</p>
<ul>
<li>La cadena vacía (“”) no es un nombre válido.</li>
<li>Lo puede contener el carácter null.</li>
<li>No se pueden crear colecciones cuyo nombre empiece por “system.”, ya que es un prefijo reservado para colecciones internas.</li>
<li>No debe contener el carácter $ (dólar).</li>
</ul>
<h2 id="32-operaciones-basicas">3.2. Operaciones básicas</h2>
<h3 id="321-insercion">3.2.1. Inserción</h3>
<p>Para insertar un documento en una colección, utilice el método:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Antonio Cuenca&quot;</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p>El comando ha añadido automáticamente el campo _id de tipo ObjectId, ya que como hemos explicado, todo documento debe tener un identificador único.
Pero el uso del tipo ObjectId para el campo _id no es obligatorio, podemos utilizar cualquier valor, siempre y cuando garanticemos su unicidad. A continuación insertamos una nueva alumna, especificando que su _id es el número 10 (tipo Long).
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="err">_id</span><span class="p">:</span><span class="err">NumberLo</span><span class="kc">n</span><span class="err">g(</span><span class="mi">10</span><span class="err">)</span><span class="p">,</span><span class="w"> </span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Eva&quot;</span><span class="p">,</span><span class="err">apellidos</span><span class="p">:</span><span class="s2">&quot;Perez Garcia&quot;</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p>Si queremos insertar múltiples documentos,podemos hacer la inserción más rápida utilizando batch inserts, que permiten insertar en bloque un array de documentos a la colección. Esto se consigue con solo pasar un array de objetos al comando insert.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.</span><span class="kc">nu</span><span class="err">merosprimos.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span>
<span class="w">  </span><span class="p">[{</span><span class="err">_id</span><span class="p">:</span><span class="mi">2</span><span class="p">},{</span><span class="err">_id</span><span class="p">:</span><span class="mi">3</span><span class="p">},{</span><span class="err">_id</span><span class="p">:</span><span class="mi">5</span><span class="p">},{</span><span class="err">_id</span><span class="p">:</span><span class="mi">7</span><span class="p">},{</span><span class="err">_id</span><span class="p">:</span><span class="mi">11</span><span class="p">},{</span><span class="err">_id</span><span class="p">:</span><span class="mi">13</span><span class="p">},{</span><span class="err">_id</span><span class="p">:</span><span class="mi">17</span><span class="p">},{</span><span class="err">_id</span><span class="p">:</span><span class="mi">19</span><span class="p">}]</span><span class="w"> </span><span class="err">)</span>
</code></pre></div></p>
<h3 id="322-borrado">3.2.2. Borrado</h3>
<p>Vaya con cuidado, eliminar colecciones completas es muy sencillo en Mongo. Esto borrará todo, tanto la colección como meta propiedades asociadas a ella o
índices creados sobre campos.
  db.alumno.drop()
Por otra parte, para eliminar solo documentos de una colección, tenemos el comando deleteOne, que recibe como parámetro el criterio de borrado en forma de documento JSON. En ese caso, solo los documentos que cumplen el criterio se eliminarán de la colección.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.</span><span class="kc">nu</span><span class="err">merosprimos.dele</span><span class="kc">te</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="w"> </span><span class="p">{</span><span class="err">id</span><span class="p">:</span><span class="mi">23</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<h3 id="323-modificacion">3.2.3. Modificación</h3>
<p>Para modificar un documento se utiliza el método <strong>update</strong>. Este método recibe dos parámetros, el primero es el criterio de actualización, y el segundo el modificador, que describe los cambios que deben realizarse.</p>
<p>Esta es la lista de modificadores:</p>
<table>
<thead>
<tr>
<th>Modificador</th>
<th>Acción</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>$set</strong></td>
<td>Asigna el valor a un campo</td>
</tr>
<tr>
<td><strong>$unset</strong></td>
<td>Elimina cualquier campo de uno o varios documentos</td>
</tr>
<tr>
<td><strong>$inc</strong></td>
<td>Incrementar el valor numérico de una clave existente</td>
</tr>
<tr>
<td><strong>$push</strong></td>
<td>Añadir elementos a un array</td>
</tr>
<tr>
<td><strong>$pull</strong></td>
<td>Elimina elementos de un array basados en un criterio</td>
</tr>
<tr>
<td><strong>$pop</strong></td>
<td>Elimina el primer o último elemento del array</td>
</tr>
<tr>
<td><strong>upsert</strong></td>
<td>Si no existe el documentoe lo crea</td>
</tr>
<tr>
<td><strong>multi</strong></td>
<td>Modifica multiples documentos</td>
</tr>
</tbody>
</table>
<p>Veamoslos:</p>
<p><strong>$set</strong></p>
<p>Asigna el valor a un campo. Si el campo todavía no existe en el documento lo creará. Se utiliza en el segundo parámetro que se le pasa al comando update.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Arturo&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">apellidos</span><span class="p">:</span><span class="s2">&quot;Leon Zapata&quot;</span><span class="w"> </span><span class="p">}</span><span class="err">)</span>
<span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.upda</span><span class="kc">te</span><span class="err">(</span><span class="w"> </span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Arturo&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$se</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">edad</span><span class="p">:</span><span class="mi">17</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p>Podemos darle valor a varios campos a la vez, simplemente informando los pares clave:valor separados por coma. En este ejemplo damos valor a tres campos diferentes con un solo comando.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Arturo&quot;</span><span class="p">},{</span><span class="err">$se</span><span class="kc">t</span><span class="p">:{</span><span class="kc">n</span><span class="err">o</span><span class="kc">ta</span><span class="p">:</span><span class="mf">8.2</span><span class="p">,</span><span class="err">orde</span><span class="kc">n</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="err">ac</span><span class="kc">t</span><span class="err">i</span><span class="kc">tu</span><span class="err">d</span><span class="p">:</span><span class="s2">&quot;positiva&quot;</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p><strong>$unset</strong></p>
<p>Para eliminar cualquier campo de uno o varios documentos lo hacemos también con el comando update pero con el modificador $unset.</p>
<p>En MongoDB es habitual utilizar los valores 1 y -1 para indicar verdadero y falso respectivamente. En este caso, al especificar valor 1 estamos diciendo que la
clave entra dentro del conjunto de campos en los que queremos aplicar el $unset.</p>
<p>De esta forma, si queremos eliminar el campo "edad" del documento que guarda la información del alumno "Arturo", lo haríamos así.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Arturo&quot;</span><span class="p">},{</span><span class="err">$u</span><span class="kc">nset</span><span class="p">:{</span><span class="err">edad</span><span class="p">:</span><span class="mi">1</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p><strong>$inc</strong></p>
<p>Este modificador puede utilizarse para incrementar o decrementar el valor numérico de una clave existente o para crear una nueva si no existe.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Arturo&quot;</span><span class="p">},{</span><span class="err">$i</span><span class="kc">n</span><span class="err">c</span><span class="p">:{</span><span class="err">pu</span><span class="kc">ntua</span><span class="err">cio</span><span class="kc">n</span><span class="p">:</span><span class="mi">2</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p>Otros operadores que podemos utilizar de forma similar son <strong>$mul, $min, $max y $currentDate</strong>.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Arturo&quot;</span><span class="p">},{</span><span class="err">$mi</span><span class="kc">n</span><span class="p">:{</span><span class="err">pu</span><span class="kc">ntua</span><span class="err">cio</span><span class="kc">n</span><span class="p">:</span><span class="mi">3</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p>El ejemplo de arriba modifica la puntuación y le asigna un 3, si esta es mayor que 3. Tambien se puede leer como que le asinga el menor de los valores, el actual o el propuesto en la actualización.</p>
<p><strong>$push</strong></p>
<p>Se utiliza para añadir elementos a un array. Si el array no existe lo crea con los elementos indicados en el push, y si ya existe los añade al final del array.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Sofia&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">apellidos</span><span class="p">:</span><span class="s2">&quot;Alarcon Sevilla&quot;</span><span class="p">}</span><span class="err">)</span>
<span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Sofia&quot;</span><span class="p">},</span>
<span class="w">                     </span><span class="p">{</span><span class="err">$push</span><span class="p">:{</span><span class="nt">&quot;asignaturas&quot;</span><span class="p">:{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Matematicas&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">n</span><span class="err">o</span><span class="kc">ta</span><span class="p">:</span><span class="mf">9.1</span><span class="p">}}}</span>
<span class="w">                    </span><span class="err">)</span>
</code></pre></div></p>
<p><strong>$pull</strong></p>
<p>Hay varias formas de eliminar elementos de un array. Cuando queremos borrar elementos basados en algún criterio, el modificador adecuado es $pull.
Partimos de un array y borraremos elementos
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.lis</span><span class="kc">ts</span><span class="err">.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="nt">&quot;todo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;lavar platos&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;colada&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tender&quot;</span><span class="p">]}</span><span class="err">)</span>
</code></pre></div>
Para eliminar la colada haríamos.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.lis</span><span class="kc">ts</span><span class="err">.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{},{</span><span class="err">$pull</span><span class="p">:{</span><span class="nt">&quot;todo&quot;</span><span class="p">:</span><span class="s2">&quot;colada&quot;</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p><strong>$pop</strong></p>
<p>Para eliminar el primer o último elemento del array.
Para eliminar el último elemento del array:
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.lis</span><span class="kc">ts</span><span class="err">.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{},{</span><span class="err">$pop</span><span class="p">:{</span><span class="kc">t</span><span class="err">odo</span><span class="p">:</span><span class="mi">1</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div>
Para eliminar el prtimer elemento del array:
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.lis</span><span class="kc">ts</span><span class="err">.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{},{</span><span class="err">$pop</span><span class="p">:{</span><span class="kc">t</span><span class="err">odo</span><span class="p">:</span><span class="mi">-1</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p><strong>Upsert</strong></p>
<p>Un upsert es un tipo de update especial. Si no se encuentra ningún documento que haga matching con el criterio del update, entonces se creará un nuevo documento combinando el criterio y lo que se quiere actualizar. Si se encuentra un documento que haga matching se actualizará normalmente.
Para decirle a MongoDB que queremos hacer un upsert, solo hay que pasar al comando update un tercer parámetro, con valor true. Esto significa que el update se comportará como lo acabamos de explicar. 
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">...</span><span class="p">},{</span><span class="err">...</span><span class="p">},</span><span class="kc">true</span><span class="err">)</span>
<span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Sofia&quot;</span><span class="p">},</span>
<span class="w">                     </span><span class="p">{</span><span class="err">$se</span><span class="kc">t</span><span class="p">:{</span><span class="err">apellidos</span><span class="p">:</span><span class="s2">&quot;Alarcon Revilla&quot;</span><span class="p">}},</span>
<span class="w">                     </span><span class="p">{</span><span class="err">upser</span><span class="kc">t</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p><strong>Multiples Documentos</strong></p>
<p>Para modificar múltiples documentos, en el tercer parámetro del update indicaremos {multi: true}. 
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.books.upda</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">la</span><span class="kc">n</span><span class="err">g</span><span class="p">:</span><span class="s2">&quot;en&quot;</span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="err">$i</span><span class="kc">n</span><span class="err">c</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">price</span><span class="p">:</span><span class="w"> </span><span class="mf">50.00</span><span class="p">}},</span><span class="w"> </span>
<span class="w">                    </span><span class="p">{</span><span class="err">mul</span><span class="kc">t</span><span class="err">i</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<h2 id="33-consultas">3.3. Consultas</h2>
<p>El método <strong>find</strong> es el qué se utiliza para hacer queries en Mongo. Es el equivalente al comando select en el modelo relacional. Al consultar una colección, Mongo nos
devolverá un subconjunto de documentos, que variará desde el conjunto vació hasta la colección completa.</p>
<p>Find tiene varios parámetros de entrada, el primero de ellos especifica los documentos que queremos recuperar, esto es, el criterio de búsqueda.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.coleccio</span><span class="kc">n</span><span class="err">.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="w"> </span><span class="err">clave</span><span class="p">:</span><span class="err">valor</span><span class="w"> </span><span class="p">}</span><span class="err">)</span>
</code></pre></div>
La función anterior nos devolvería documentos de la colección coleccion cuyo campo clave tenga un valor igual a valor.</p>
<p>El valor por defecto para este primer parámetro es {}, que significa "cualquier documento". Por tanto una query como db.coleccion1.find({ }) devolverá todos los documentos de la colección coleccion1. Como es el valor por defecto para el criterio de la consulta es equivalente hacer find({ }) y find( ).
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="err">edad</span><span class="p">:</span><span class="mi">17</span><span class="p">}</span><span class="err">)</span>
<span class="w">    </span><span class="err">db.alum</span><span class="kc">n</span><span class="err">o.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="s2">&quot;Antonio&quot;</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p>Igual que en SQL podemos especificar los campos que queremos recuperar (select campo1, campo2, campo3 from tabla ... ), podemos hacerlo también en Mongo. Para ello solo tenemos que pasar un segundo parámetro al método find, en el que decimos los que queremos.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.coleccio</span><span class="kc">n</span><span class="mf">1.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="w"> </span><span class="p">},{</span><span class="w"> </span><span class="err">clave</span><span class="mi">3</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">clave</span><span class="mi">4</span><span class="p">:</span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="err">)</span>
</code></pre></div>
Los campos que queremos que sean devueltos les pondremos el valor 1. El campo _id siempre se devuelve. También podemos especificar los campos que no queremos que sean devueltos, en este caso como valor para cada una de esos campos, pondremos cero. El resultado será que se devolverán el resto de documentos.
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="err">db.coleccio</span><span class="kc">n</span><span class="mf">1.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="w"> </span><span class="p">},{</span><span class="w"> </span><span class="err">clave</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">clave</span><span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<h3 id="331-operadores-de-comparacion">3.3.1 Operadores de comparación</h3>
<p>MongoDB permite utilizar los siguientes operadores de comparación:</p>
<table>
<thead>
<tr>
<th>Operador</th>
<th>Condición</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>$lt</strong></td>
<td>&lt;</td>
</tr>
<tr>
<td><strong>$lte</strong></td>
<td>&lt;=</td>
</tr>
<tr>
<td><strong>$gt</strong></td>
<td>&gt;</td>
</tr>
<tr>
<td><strong>$gte</strong></td>
<td>&gt;=</td>
</tr>
</tbody>
</table>
<p>La sintaxis es:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">clave</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$operador</span><span class="p">:</span><span class="w"> </span><span class="err">valor</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
Así si por ejemplo queremos recuperar los libros con un precio mayor que 10 lo haríamos utilizando el operador <strong>$gt</strong> sobre el campo precio:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="nt">&quot;precio&quot;</span><span class="p">:{</span><span class="err">$g</span><span class="kc">t</span><span class="p">:</span><span class="mi">10</span><span class="p">}},{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<h3 id="332-operadores-logicos">3.3.2. Operadores lógicos</h3>
<table>
<thead>
<tr>
<th>Operador</th>
<th>Acción</th>
<th>Sintaxis</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>$in</strong></td>
<td>Recupera documentos cuyo campo clave esté entre alguno de los valores especificados en el array</td>
<td>clave:{$in:[valor1,valor2,valorN]}</td>
</tr>
<tr>
<td><strong>$nin</strong></td>
<td>Recupera documentos cuyo campo clave NO esté entre alguno de los valores especificados en el array</td>
<td>clave:{$nin:[valor1,valor2,valorN]}</td>
</tr>
<tr>
<td><strong>$or</strong></td>
<td>Con el siguiente find, vamos a recuperar aquellos documentos que estén en stock (enstock:false) o que tengan editorial (editorial:null).</td>
<td>$or:[{clave1:valor1},{clave2:valor2},{claveN:valorN}]</td>
</tr>
<tr>
<td><strong>$nor</strong></td>
<td>Con el siguiente find, vamos a recuperar aquellos documentos que no estén en stock (enstock:false) o que no tengan editorial (editorial:null).</td>
<td>$nor:[{clave1:valor1},{clave2:valor2},{claveN:valorN}]</td>
</tr>
<tr>
<td><strong>$not</strong></td>
<td>Es lo que se conoce como un metacondicional, que son opeadores que pueden aplicarse por encima de cualquier otro criterio. Su sintaxis es sencilla, solo hay que ponerlo “fuera” de aquello que queremos negar.</td>
<td>$not:{criterio}</td>
</tr>
<tr>
<td><strong>$exist</strong></td>
<td>Se utiliza para comprobar los documentos que tienen informado o no un campo determinado</td>
<td>clave:{$exists:boolean}</td>
</tr>
</tbody>
</table>
<p><strong>Ejemplos</strong></p>
<p><div class="highlight"><pre><span></span><code><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="err">edi</span><span class="kc">t</span><span class="err">orial</span><span class="p">:{</span><span class="err">$i</span><span class="kc">n</span><span class="p">:[</span><span class="s2">&quot;Debolsillo&quot;</span><span class="p">,</span><span class="s2">&quot;Planeta&quot;</span><span class="p">,</span><span class="s2">&quot;Gigamesh&quot;</span><span class="p">]}},</span>
<span class="w">              </span><span class="p">{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">edi</span><span class="kc">t</span><span class="err">orial</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="w">             </span><span class="err">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="err">edi</span><span class="kc">t</span><span class="err">orial</span><span class="p">:{</span><span class="err">$</span><span class="kc">n</span><span class="err">i</span><span class="kc">n</span><span class="p">:[</span><span class="s2">&quot;Debolsillo&quot;</span><span class="p">,</span><span class="s2">&quot;Planeta&quot;</span><span class="p">,</span><span class="s2">&quot;Gigamesh&quot;</span><span class="p">]}},</span>
<span class="w">                </span><span class="p">{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">edi</span><span class="kc">t</span><span class="err">orial</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="w">               </span><span class="err">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="err">$or</span><span class="p">:[{</span><span class="err">e</span><span class="kc">nst</span><span class="err">ock</span><span class="p">:</span><span class="kc">false</span><span class="p">},{</span><span class="err">edi</span><span class="kc">t</span><span class="err">orial</span><span class="p">:</span><span class="kc">null</span><span class="p">}]},</span>
<span class="w">                </span><span class="p">{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">edi</span><span class="kc">t</span><span class="err">orial</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">e</span><span class="kc">nst</span><span class="err">ock</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="w">               </span><span class="err">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="err">$</span><span class="kc">n</span><span class="err">or</span><span class="p">:[{</span><span class="err">e</span><span class="kc">nst</span><span class="err">ock</span><span class="p">:</span><span class="kc">false</span><span class="p">},{</span><span class="err">edi</span><span class="kc">t</span><span class="err">orial</span><span class="p">:</span><span class="kc">null</span><span class="p">}]},</span>
<span class="w">                </span><span class="p">{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">edi</span><span class="kc">t</span><span class="err">orial</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">e</span><span class="kc">nst</span><span class="err">ock</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="w">               </span><span class="err">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">$</span><span class="kc">n</span><span class="err">o</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$eq</span><span class="p">:</span><span class="mi">480</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                 </span><span class="p">{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="w">               </span><span class="err">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:{</span><span class="err">$exis</span><span class="kc">ts</span><span class="p">:</span><span class="kc">true</span><span class="p">}},{</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">null</p>
<p>Tiene un comportamiento un poco extraño, ya que hace matching en los siguientes casos:</p>
<ul>
<li>Con valores que almacenan null, por ejemplo “y” : null</li>
<li>Con campos que no existen en un documento. Si por ejemplo el documento A no tiene informado el campo x, una búsqueda por { x:null } sí que se encontraría.</li>
</ul>
</div>
<h3 id="333-busqueda-de-texto">3.3.3. Búsqueda de texto</h3>
<p>En MongoDB, podemos realizar búsquedas de texto usando expresiones regulares. </p>
<p>{ <campo>: /patron/<options> }</p>
<ul>
<li>La opción "i" hace que la búsqueda sea insensible a mayúsculas y minúsculas.</li>
<li>La opción "u" hace que sopretye Unicode.</li>
</ul>
<p>Aquí tienes un ejemplo:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="err">au</span><span class="kc">t</span><span class="err">or</span><span class="p">:</span><span class="err">/pos</span><span class="kc">te</span><span class="err">guillo/iu</span><span class="p">},{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">au</span><span class="kc">t</span><span class="err">or</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="err">).pre</span><span class="kc">tt</span><span class="err">y()</span>
</code></pre></div></p>
<h3 id="334-consultas-con-arrays">3.3.4. Consultas con Arrays</h3>
<p>Creamos una colección para ver los ejemplos
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.comida.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="kc">fruta</span><span class="p">:[</span><span class="s2">&quot;manzana&quot;</span><span class="p">,</span><span class="s2">&quot;platano&quot;</span><span class="p">,</span><span class="s2">&quot;pera&quot;</span><span class="p">]}</span><span class="err">)</span>
</code></pre></div></p>
<p>Para buscar documentos que tengan un elemento concreto dentro del array, es tan simple como poner el nombre del array y el valor que queremos encontrar.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.comida.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">dO</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="kc">fruta</span><span class="p">:</span><span class="s2">&quot;pera&quot;</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p>Podemos utilizar cualquiera de los operadores aprendidos hasta el momento, como por ejemplo <strong>$in</strong>, para recuperar documentos que tengan alguno de los
valores especificados.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.comida.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">dO</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="kc">fruta</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$i</span><span class="kc">n</span><span class="p">:[</span><span class="s2">&quot;pera&quot;</span><span class="p">,</span><span class="s2">&quot;platano&quot;</span><span class="p">,</span><span class="s2">&quot;melocoton&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p>Si necesita recuperar arrays que contengan más de un elemento, puede utilizar el operador <strong>$all</strong>, que permite especificar una lista de elementos.
Modificamos la colección para ver unos ejemplos
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.comida.drop()</span>
<span class="w">  </span><span class="err">db.comida.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="err">_id</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kc">fruta</span><span class="p">:[</span><span class="s2">&quot;manzana&quot;</span><span class="p">,</span><span class="s2">&quot;platano&quot;</span><span class="p">,</span><span class="s2">&quot;melocoton&quot;</span><span class="p">]}</span><span class="err">)</span>
<span class="w">  </span><span class="err">db.comida.i</span><span class="kc">nsert</span><span class="err">o</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="err">_id</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="kc">fruta</span><span class="p">:[</span><span class="s2">&quot;manzana&quot;</span><span class="p">,</span><span class="s2">&quot;kiwi&quot;</span><span class="p">,</span><span class="s2">&quot;naranja&quot;</span><span class="p">]}</span><span class="err">)</span>
<span class="w">  </span><span class="err">db.comida.i</span><span class="kc">nsert</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="err">_id</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="kc">fruta</span><span class="p">:[</span><span class="s2">&quot;cerezas&quot;</span><span class="p">,</span><span class="s2">&quot;platano&quot;</span><span class="p">,</span><span class="s2">&quot;manzana&quot;</span><span class="p">]}</span><span class="err">)</span>
</code></pre></div></p>
<p>Si ahora queremos documentos que tengan los elementos platano y manzana, lo haremos con <strong>$all</strong> de esta forma.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.comida.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="kc">fruta</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$all</span><span class="p">:[</span><span class="s2">&quot;platano&quot;</span><span class="p">,</span><span class="s2">&quot;manzana&quot;</span><span class="p">]}}</span><span class="err">)</span>
</code></pre></div></p>
<p>Para recuperar documentos que tengan un valor concreto en cierto índice del array, se consigue poniendo dicho índice (empezando desde cero) tras un punto
del array. Es decir: <strong>fruta.0</strong> es el primer elemento del array.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.comida.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="nt">&quot;fruta.0&quot;</span><span class="p">:</span><span class="s2">&quot;cerezas&quot;</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p><strong>$size</strong></p>
<p>Un condicional útil para las consultas contra arrays es <strong>$size</strong>, que permite recuperar arrays que tienen un determinado tamaño.
La siguiente consulta muestra los documentos que tenga 2 frutas.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.comida.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="kc">fruta</span><span class="p">:{</span><span class="err">$size</span><span class="p">:</span><span class="mi">2</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p><strong>$slice</strong></p>
<p>El operador <strong>$slice</strong> se utiliza para devolver un subconjunto de los elementos delarray. No influye en el criterio de búsqueda, solo es para especificar a mongo lo
que queremos que nos devuelva. Su sintaxis es la siguiente.</p>
<p>clave: { $slice: x}</p>
<p>Donde según x:</p>
<ul>
<li>x es un entero positivo (p.ej 10), devuelve los primeros x elementos del array clave.</li>
<li>x es un entero negativo (p.ej -10), devuelve los últimos x elementos del array clave.</li>
<li>x es un array (p.ej [2,4], devuelve los elementos desde el 2 al 4, ambos incluidos.</li>
</ul>
<p>Ejemplos:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.comida.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{},{</span><span class="kc">fruta</span><span class="p">:{</span><span class="err">$slice</span><span class="p">:</span><span class="mi">2</span><span class="p">}}</span><span class="err">)</span>
<span class="w">  </span><span class="err">db.comida.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{},{</span><span class="kc">fruta</span><span class="p">:{</span><span class="err">$slice</span><span class="p">:</span><span class="mi">-2</span><span class="p">}}</span><span class="err">)</span>
<span class="w">  </span><span class="err">db.comida.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{},{</span><span class="kc">fruta</span><span class="p">:{</span><span class="err">$slice</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]}}</span><span class="err">)</span>
</code></pre></div></p>
<p><strong>Conjuntos de valores</strong></p>
<p>Si queremos obtener todos los diferentes valores que existen en un campo, utilizaremos el método distinct
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.grades.dis</span><span class="kc">t</span><span class="err">i</span><span class="kc">n</span><span class="err">c</span><span class="kc">t</span><span class="err">(&#39;</span><span class="kc">t</span><span class="err">ype&#39;)</span>
</code></pre></div></p>
<p><strong>Contar valores</strong></p>
<p>Para contar el número de documentos, en vez de find usaremos el método count. Por ejemplo:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.grades.cou</span><span class="kc">nt</span><span class="err">(</span><span class="p">{</span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="s2">&quot;exam&quot;</span><span class="p">}</span><span class="err">)</span>
<span class="w">  </span><span class="err">db.grades.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="s2">&quot;exam&quot;</span><span class="p">}</span><span class="err">).cou</span><span class="kc">nt</span><span class="err">()</span><span class="w"> </span>
<span class="w">  </span><span class="err">db.grades.cou</span><span class="kc">nt</span><span class="err">(</span><span class="p">{</span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="s2">&quot;essay&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">score</span><span class="p">:{</span><span class="err">$g</span><span class="kc">t</span><span class="p">:</span><span class="mi">90</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<h3 id="335-documentos-embebidos">3.3.5. Documentos embebidos</h3>
<p>Para hacer queries contra campos de documentos embebidos dentro de otros documentos, solamente hay que poner la “ruta” completa de claves separada por puntos. </p>
<p>Es decir, si tenemos por ejemplo una estructura como esta para los libros.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.save(</span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;9788408117117&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;titulo&quot;</span><span class="p">:</span><span class="s2">&quot;Circo Máximo&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;autor&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="s2">&quot;Santiago&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="err">apellidos</span><span class="p">:</span><span class="s2">&quot;Posteguillo Gómez&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="kc">na</span><span class="err">cimie</span><span class="kc">nt</span><span class="err">o</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                 </span><span class="err">a</span><span class="kc">n</span><span class="err">yo</span><span class="p">:</span><span class="mi">1967</span><span class="p">,</span>
<span class="w">                                 </span><span class="err">ciudad</span><span class="p">:</span><span class="s2">&quot;Valencia&quot;</span>
<span class="w">                   </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">         </span><span class="nt">&quot;editorial&quot;</span><span class="p">:</span><span class="s2">&quot;Planeta&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="nt">&quot;enstock&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">         </span><span class="nt">&quot;paginas&quot;</span><span class="p">:</span><span class="mi">1100</span><span class="p">,</span>
<span class="w">         </span><span class="nt">&quot;precio&quot;</span><span class="p">:</span><span class="mf">21.75</span>
<span class="w">  </span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p>Podemos lanzar queries directamente contra los documentos embebidos, autor y nacimiento de esta forma.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">dO</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="nt">&quot;autor.nombre&quot;</span><span class="p">:</span><span class="s2">&quot;Santiago&quot;</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p>El find anterior recuperará el primer documento donde el campo nombre, del campo autor sea “Santiago”.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">dO</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="nt">&quot;autor.nacimiento.anyo&quot;</span><span class="p">:{</span><span class="err">$g</span><span class="kc">t</span><span class="p">:</span><span class="mi">1965</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div>
El find anterior recuperará el primer documento donde el campo anyo, del campo nacimiento, del campo autor sea mayor que 1965.</p>
<h2 id="34-cursores">3.4. Cursores</h2>
<p>La base de datos devuelve resultados para find utilizando cursores, que realmente es un puntero a los resultados de una query, no los resultados en si
mismos. Los clientes integrados con Mongo, iteran sobre los cursores para recuperar los resultados, y ofrecen un conjunto de funcionalidades como limitar
el número de resultados, saltar para no tener que recuperar obligatoriamente los primeros, ordenarlos, etc.</p>
<p>Las opciones de query más comunes son limitar el número de resultados, saltar un número de resultados, y ordenarlos. Todas estas opciones deben especificarse en la propia query al sistema.</p>
<p>Para fijar un límite, debe concatenar la función <strong>limit</strong> tras la función find. Por ejemplo, para solo recuperar los primeros tres libros almacenados, use esto:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{},{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="err">).limi</span><span class="kc">t</span><span class="err">(</span><span class="mi">3</span><span class="err">)</span>
</code></pre></div>
La función <strong>skip</strong> para “saltar” algunos resultados, funciona de forma similar a limit, concatenándola tras find. Con el siguiente skip(3) saltamos los primeros
tres títulos, y el cursor empezará a devolver a partir del cuarto.
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{},{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="err">).skip(</span><span class="mi">3</span><span class="err">)</span>
</code></pre></div></p>
<p>La función <strong>sort</strong> sirve para ordenar los resultados que se devuelven. Recibe un objeto json con las claves y un valor 1 (para ordenación ascendente) o -1 (para ordenación descendente).
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{},{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="err">).sor</span><span class="kc">t</span><span class="err">(</span><span class="p">{</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">-1</span><span class="p">}</span><span class="err">)</span>
</code></pre></div></p>
<p>Estas tres funciones, limit, skip y sort, pueden combinarse como se quiera para recuperar exactamente lo que queramos.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">db.libro.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{},{</span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="err">).limi</span><span class="kc">t</span><span class="err">(</span><span class="mi">3</span><span class="err">).skip(</span><span class="mi">2</span><span class="err">).sor</span><span class="kc">t</span><span class="err">(</span><span class="p">{</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">-1</span><span class="p">}</span><span class="err">).pre</span><span class="kc">tt</span><span class="err">y()</span>
</code></pre></div></p>
<h2 id="35-agregacion">3.5. Agregación</h2>
<p>Una vez tenemos datos almacenados en MongoDB, queremos hacer algo más que solamente recuperarlos, queremos analizarlos de diversas formas interesantes. Esto lo conseguimos con la función de agregación que MongoDB ofrece.</p>
<p>La agregación nos permite transformar y combinar documentos en una colección. Básicamente, se construye un pipeline (secuencia de comandos) que procesan un conjunto de documentos a través de varios “bloques”: filtrado, proyecciones, agrupaciones, ordenación, limitación y skipping.</p>
<p>Por ejemplo, si de la colección de  <a href="../libros.json" target="_blank">libros</a>  de ejemplo quisiéramos saber los tres autores con más libros escritos, crearíamos un pipeline con los siguientes pasos:</p>
<ul>
<li>Proyectaríamos el autor de cada libro.</li>
<li>Agruparíamos los autores por nombre, contando el número de ocurrencias.</li>
<li>Ordenaríamos los autores por dicho número de ocurrencias, descendentemente.</li>
<li>Limitaríamos el resultado a los primeros tres.</li>
</ul>
<p>Cada uno de estos pasos se corresponde con un operador de agregación</p>
<ol>
<li>
<p><strong>{“$project” : { “autor” : 1 }}</strong> Esto “proyecta/extrae” el autor de cada documento. La sintaxis es similar al selector de campos utilizado con find (el segundo  parámetro), especificando “nombrecampo”: para incluir o “nombrecampo”:0 para excluir. Después de esta operación, cada documento de los resultados es algo así: 
{“_id”:id,  “autor”:”nombre  de  autor”}.  Estos  resultados  solo  existen  en memoria, no se escribirán nunca a disco</p>
</li>
<li>
<p><strong>{“$group” : { “_id”:”$autor”, “count”: {“$sum”:1}}}</strong>  Eso agrupa por autores e incrementa (“count”) para cada documento en los que el autor aparece.
Primero especificamos el campo por el que queremos agrupar, que es “autor” (Esto lo indicamos con el “_id”:”$autor”). Podríamos entenderlo como: tras el Group habrá un documento resultado para cada autor, por lo que “autor” se convertirá en el identificador único (“_id”).
El segundo campo significa añadir 1 al campo “count” para cada documento en el grupo. Fíjese  que los documentos de entrada (libro) no tienen el  campo “count”, es un nuevo campo creado por el “$group”.
Al final de este paso, cada documento resultado es algo como:  {“_id”:”nombre_de_autor”, “count”: numero_de_libros}</p>
</li>
<li>
<p><strong>{“$sort” : {“count” : -1}}</strong> Esto reordena los resultados por el valor del campo “count” descendentemente (-1). En caso de ascendente sería “count”:1.</p>
</li>
<li>
<p><strong>{“$limit” : 3}</strong>  Limita el número de resultados a los primeros tres.</p>
</li>
</ol>
<p>Veamos todo esto con más detalle y partiendo de un ejemplo con una colección de libros</p>
<p><div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="err">au</span><span class="kc">t</span><span class="err">or</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$group</span><span class="p">:{</span><span class="err">_id</span><span class="p">:</span><span class="s2">&quot;$autor&quot;</span><span class="p">,</span><span class="err">cou</span><span class="kc">nt</span><span class="p">:{</span><span class="err">$sum</span><span class="p">:</span><span class="mi">1</span><span class="p">}}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$sor</span><span class="kc">t</span><span class="p">:{</span><span class="err">cou</span><span class="kc">nt</span><span class="p">:</span><span class="mi">-1</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$limi</span><span class="kc">t</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="w">                  </span><span class="err">)</span>
</code></pre></div>
Resultado:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Santiago Posteguillo&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;count&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;George R.R. Martin&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;count&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Anna Casanovas&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;count&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></p>
<h3 id="351-operadores-del-pipeline">3.5.1. Operadores del pipeline</h3>
<p>Cada operador recibe un conjunto de documentos, hace algún tipo de transformación sobre ellos, y después pasa el resultado de la transformación. 
Esto es lo que se conoce como pipeline.</p>
<p><img alt="Pipelinen" src="../Agregaciones.png" style="width:90%;margin:auto;display:block" /></p>
<h4 id="3511-operador-match">3.5.1.1. Operador $match</h4>
<p>El operador <strong>$match</strong> filtra documentos de forma que podamos ejecutar una agregación sobre un subconjunto de documentos, puede utilizar todos los operadores para query estudiados ($gt, $lt, $in, etc).</p>
<p>Con el siguiente ejemplo, filtraríamos solo aquellos libros con un precio mayor que 20, reduciendo el conjunto inicial de documentos y formando la entrada de 
los siguientes pasos del pipeline.
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$ma</span><span class="kc">t</span><span class="err">ch</span><span class="p">:{</span><span class="err">precio</span><span class="p">:{</span><span class="err">$g</span><span class="kc">t</span><span class="p">:</span><span class="mi">20</span><span class="p">}}}</span><span class="err">)</span>
</code></pre></div>
Como hemos comentado, cualquiera de las condiciones estudiadas del find podemos utilizarlas con match. Como por ejemplo, los libros en stock. 
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$ma</span><span class="kc">t</span><span class="err">ch</span><span class="p">:{</span><span class="err">e</span><span class="kc">nst</span><span class="err">ock</span><span class="p">:</span><span class="kc">true</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<h4 id="3512-operador-project">3.5.1.2. Operador $project</h4>
<p>La “proyección” es mucho más potente en el pipeline que en el lenguaje “normal” de la query. <strong>$project</strong> nos permite extraer campos de subdocumentos, renombrar campos, y realizar operaciones interesantes sobre ellos. </p>
<p>La operación más sencilla de $project realiza una selección simple de unos documentos de entrada, es decir, de los documentos de entrada con campos a, b, c y d, con $project decimos que nos quedamos únicamente con a y c. Para incluir o excluir un campo, se utiliza la misma sintaxis que para el segundo argumento de una query, es decir “nombrecampo”: 1 para incluir o “nombrecampo”:0 para excluir. Por defecto, el campo “_id” siempre se devuelve si existe en los documentos de entrada. Lo podemos eliminar por ejemplo utilizando $project de la siguiente forma, en la que devolveríamos todos los campos excepto “_id”. {$project:{ “_id”:0 }}.  </p>
<p>Con $project también podemos renombrar el campo proyectado. Por ejemplo si queremos devolver el campo “_id” de los libros como “isbn” haríamos esto. 
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="err">isb</span><span class="kc">n</span><span class="p">:</span><span class="s2">&quot;$_id&quot;</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p>La clave está en $_id, cuando ponemos el símbolo del dólar ($) más el nombre de un campo, nos estamos refiriendo al valor que tomará dicho campo para cada documento en el entorno de agregación. Por tanto con $project: {“isbn”:”$_id”} estamos diciendo que proyectamos un nuevo campo isbn como el valor que tendrá el campo _id en cada documento de entrada. 
Igualmente podríamos haber renombrado cualquier otro campo, por ejemplo el campo “enstock” como “disponible”. 
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="err">isb</span><span class="kc">n</span><span class="p">:</span><span class="s2">&quot;$_id&quot;</span><span class="p">,</span><span class="err">dispo</span><span class="kc">n</span><span class="err">ible</span><span class="p">:</span><span class="s2">&quot;$enstock&quot;</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<h4 id="3513-operador-group">3.5.1.3. Operador $group</h4>
<p>Agrupa los documentos con el propósito de calcular valores agregados de una colección de documentos. Cuando referenciamos al valor de un campo lo haremos poniendo entre comillas un $ delante del nombre del campo. Ejemplo:</p>
<p><div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">[{</span>
<span class="w">   </span><span class="err">$group</span><span class="p">:{</span>
<span class="w">           </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$autor&quot;</span><span class="p">,</span>
<span class="w">           </span><span class="kc">t</span><span class="err">o</span><span class="kc">tal</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$sum</span><span class="p">:</span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}]</span><span class="err">)</span>
</code></pre></div>
Si lo que queremos es que el valor del identificador contenga un objeto, lo podemos hacer asociándolo como valor:</p>
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">[{</span>
<span class="w">   </span><span class="err">$group</span><span class="p">:{</span>
<span class="w">          </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;escritor&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$autor&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">           </span><span class="kc">t</span><span class="err">o</span><span class="kc">tal</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$sum</span><span class="p">:</span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">]</span><span class="err">)</span>
</code></pre></div>
<h4 id="3514-expresiones-en-el-pipeline">3.5.1.4. Expresiones en el Pipeline</h4>
<p>La operaciones más simples en $project son inclusión, exclusión y nombres de campo (“$nombrecampo”). Aunque hay otras más, mucho más potentes. Podemos utilizar expresiones, que nos permiten combinar múltiples literales y variables en un valor único. </p>
<p><strong>Expresiones matemáticas</strong>. </p>
<p>Las expresiones matemáticas nos permiten manipular valores numéricos contra los que operar, y que normalmente se especifican en un array. </p>
<p>Esta es la sintaxis para cada operador matemático. </p>
<ul>
<li>“$add”: [ expr1, expr2, ... , exprN ]. Toma uno o mas expresiones y las suma. </li>
<li>“$substract”: [ expr1, expr2 ]. Resta la expr2 a la expr1. </li>
<li>“$multiply”: [ expr1, expr2, ..., expón ]. Toma una o más expresiones y las multiplica. </li>
<li>“$divide”: [ expr1, expr2 ]. Divide la expr1 entre la expr2. </li>
<li>“$mod”: [ expr1, expr2 ]. Divide la expr1 entre la expr2 y devuelve el resto. </li>
</ul>
<p>Por ejemplo, para obtener el montante total de los productos agrupados por fabricante, haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">[{</span>
<span class="w">  </span><span class="err">$group</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;escritor&quot;</span><span class="p">:</span><span class="s2">&quot;$autor&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="kc">t</span><span class="err">o</span><span class="kc">tal</span><span class="err">Precio</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">$sum</span><span class="p">:</span><span class="s2">&quot;$precio&quot;</span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}]</span><span class="err">)</span>
</code></pre></div>
<p><strong>Expresiones de fechas</strong>. </p>
<p>Muchas agregaciones son basadas en el tiempo. ¿Qué ocurrió la semana pasada? ¿Y el mes pasado?. Es por esto que el entorno de agregación tiene un conjunto de expresiones  que pueden utilizarse para extraer información sobre fechas de una forma muy usable, son: “$year”, “$month”,“$week”, “$dayOfMonth”, “$dayOfWeek”, “$dayOfYear”, “$hour”, “$minute” y “$second”. </p>
<p>Con siguiente sentencia de agregación vamos a recuperar tanto la fecha, como el año de dicha fecha, gracias a la expresión “$year”.</p>
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="kc">fe</span><span class="err">cha</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">year</span><span class="p">:{</span><span class="err">$year</span><span class="p">:</span><span class="s2">&quot;$fecha&quot;</span><span class="w"> </span><span class="p">}}}</span><span class="err">)</span>
</code></pre></div>
<p><strong>Expresiones de Strings</strong>.</p>
<p>Hay una pocas operaciones básicas sobre cadenas de caracteres que también podemos utilizar. Son estas: </p>
<p>“$substr”: [ expr, start, length ]. Devuelve el substring de la expresión expr, empezando en la posición start de la cadena y devolviendo desde ahí un total de length caracteres. En el siguiente ejemplo proyectamos un campo inicio los primeros quince caracteres del campo título.<br />
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">i</span><span class="kc">n</span><span class="err">icio</span><span class="p">:{</span><span class="err">$subs</span><span class="kc">tr</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;$titulo&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">]</span><span class="w"> </span><span class="p">}}}</span><span class="err">)</span>
</code></pre></div></p>
<p>“$concat”: [ expr1, expr2, ..., exprN ]. Devuelve un nuevo string resultado de la concatenación de expr1, expr2 y así hasta exprN. En el siguiente ejemplo proyectamos un campo descripción en el que concatenamos el titulo, un guión, y el autor.<br />
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="err">descripcio</span><span class="kc">n</span><span class="p">:{</span><span class="err">$co</span><span class="kc">n</span><span class="err">ca</span><span class="kc">t</span><span class="p">:[</span><span class="s2">&quot;$titulo&quot;</span><span class="p">,</span><span class="s2">&quot; - &quot;</span><span class="p">,</span><span class="s2">&quot;$autor&quot;</span><span class="p">]},</span><span class="err">_id</span><span class="p">:</span><span class="mi">0</span><span class="p">}}</span><span class="err">)</span>
</code></pre></div></p>
<p>“$toLower”: expr. Devuelve un string en minúsculas. 
“$toUpper”: expr. Devuelve un string en mayúsculas. </p>
<p><strong>Expresiones lógicas</strong>.</p>
<p>Existen algunas operaciones lógicas que podemos utilizar. Replanteamos el ejemplo anterior de la proyección del campo “barato” utilizando uno de estos comparadores.  </p>
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="err">bara</span><span class="kc">t</span><span class="err">o</span><span class="p">:{</span><span class="err">$g</span><span class="kc">t</span><span class="p">:[</span><span class="mi">15</span><span class="p">,</span><span class="s2">&quot;$precio&quot;</span><span class="p">]},</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="err">)</span>
</code></pre></div>
<h4 id="3515-operador-sort">3.5.1.5. Operador $sort</h4>
<p>Podemos ordenar por cualquier campo o conjunto de campos utilizando la misma sintaxis que para las queries “normales”. </p>
<p>Si tenemos que ordenar un número de documentos muy elevado, es recomendable desde el punto de vista del rendimiento, que hagamos la ordenación al principio del pipeline y además tengamos un índice por el conjunto de campos por los que ordenar. De otra forma, $sort puede ser lento y consumir mucha memoria. </p>
<p>Se pueden utilizar tanto campos existentes como campos proyectados para ordenar. De esta forma podemos por ejemplo completar la agregración en la que calculábamos la media aritmética del precio de los libros por autor, y ordenar los resultados por dicha media calculada ascendentemente. </p>
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$group</span><span class="p">:{</span><span class="err">_id</span><span class="p">:</span><span class="s2">&quot;$autor&quot;</span><span class="p">,</span><span class="w"> </span><span class="err">media</span><span class="p">:{</span><span class="err">$avg</span><span class="p">:</span><span class="s2">&quot;$precio&quot;</span><span class="p">}}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$sor</span><span class="kc">t</span><span class="p">:{</span><span class="err">media</span><span class="p">:</span><span class="mi">1</span><span class="p">}}</span>
<span class="w">                  </span><span class="err">)</span>
</code></pre></div>
<p>Para ordenar cada campo es valor 1, para ordenación ascendente y -­‐1 para descendente. En el siguiente ejemplo ordenamos primero por precio descendente y después por páginas ascendente.
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$sor</span><span class="kc">t</span><span class="p">:{</span><span class="err">precio</span><span class="p">:</span><span class="mi">-1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}}</span>
<span class="w">                  </span><span class="err">)</span>
</code></pre></div></p>
<h4 id="3516-operador-limit">3.5.1.6. Operador $limit</h4>
<p>La función $limit toma un número N y devuelve los primeros N documentos resultantes. 
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$sor</span><span class="kc">t</span><span class="p">:{</span><span class="err">precio</span><span class="p">:</span><span class="mi">-1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$limi</span><span class="kc">t</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="w">                  </span><span class="err">)</span>
</code></pre></div></p>
<h4 id="3517-operador-skip">3.5.1.7. Operador $skip</h4>
<p>La función $skip toma un número N y desecha los primeros N documentos del conjunto de resultados. 
<div class="highlight"><pre><span></span><code><span class="err">db.libros.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:{</span><span class="err">precio</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$sor</span><span class="kc">t</span><span class="p">:{</span><span class="err">precio</span><span class="w"> </span><span class="p">:</span><span class="mi">-1</span><span class="p">,</span><span class="err">pagi</span><span class="kc">nas</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="err">$skip</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="w">                  </span><span class="err">)</span>
</code></pre></div></p>
<h4 id="3518-operador-unwind">3.5.1.8. operador $unwind</h4>
<p>Dentro de una agregación podemos utilizar el operador <strong>$unwind</strong>, se podría traducir como "aplanar" ya que aplana los datos de un array convirtiéndo sus elementos en documentos independientes. Puede ser útil para poder acceder al interior de los elementos de un array cuando estos no son atómicos.</p>
<div class="highlight"><pre><span></span><code><span class="err">db.usuario.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">{</span><span class="err">$projec</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">come</span><span class="kc">ntar</span><span class="err">ios</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
<span class="w">                     </span><span class="p">{</span><span class="err">$u</span><span class="kc">n</span><span class="err">wi</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="p">:</span><span class="s2">&quot;$comentarios&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">                    </span><span class="err">)</span>
</code></pre></div>
<h4 id="3519-operador-lookup">3.5.1.9. operador $lookup</h4>
<p>El operador $lookup se utiliza para realizar una operación de "join" entre dos colecciones en MongoDB, lo que te permite combinar documentos de una colección con documentos de otra basándote en un campo común. </p>
<p>Supongamos que tienes dos colecciones: ventas y clientes, y deseas combinar documentos de ambas basándote en el campo cliente_id que se encuentra en ambas colecciones, y quieres obtener todos los pedidos junto con la información del cliente al que pertenecen.
<div class="highlight"><pre><span></span><code><span class="err">db.ve</span><span class="kc">ntas</span><span class="err">.aggrega</span><span class="kc">te</span><span class="err">(</span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$lookup</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kc">fr</span><span class="err">om</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;clientes&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// El nombre de la segunda colección</span>
<span class="w">      </span><span class="err">localField</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cliente_id&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// El campo en la colección &quot;ventas&quot;</span>
<span class="w">      </span><span class="kc">f</span><span class="err">oreig</span><span class="kc">n</span><span class="err">Field</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cliente_id&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// El campo en la colección &quot;clientes&quot;</span>
<span class="w">      </span><span class="err">as</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cliente_info&quot;</span><span class="w">  </span><span class="c1">// El nombre del nuevo campo que contendrá la información del cliente</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span><span class="err">);</span>
</code></pre></div></p>
<ol>
<li>Usamos la operación <strong>aggregate</strong> en la colección ventas.</li>
<li>Dentro del $lookup, especificamos la colección clientes con la propiedad <strong>from</strong>.</li>
<li>Luego, definimos <strong>localField</strong> como "clienter_id", que es el campo en la colección ventas que se usará como clave para hacer la unión.</li>
<li><strong>foreignField</strong> se establece en "cliente_id", que es el campo correspondiente en la colección clientes.</li>
<li>Con la propiedad <strong>as</strong>, podemos darle un nombre al nuevo campo que contendrá la información del cliente. En este caso, lo nombramos "cliente_info".</li>
</ol>
<p>Después de ejecutar esta consulta, obtendrás un nuevo campo en cada documento de la colección ventas llamado "cliente_info". Este campo contendrá la información del cliente al que pertenece la venta, lo que te permite acceder a los datos del cliente directamente desde los documentos de la colección ventas.</p>
<p>Con $lookp tambien podemos hacer un left join deberiamos incluir el parametro "preserveNullAndEmptyArrays: true" en el $unwind, tal como muestra el ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="err">db.produc</span><span class="kc">t</span><span class="err">os.aggrega</span><span class="kc">te</span><span class="err">(</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$lookup</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kc">fr</span><span class="err">om</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ventas&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">localField</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_id&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="kc">f</span><span class="err">oreig</span><span class="kc">n</span><span class="err">Field</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;producto_id&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">as</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;datos_ventas&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$u</span><span class="kc">n</span><span class="err">wi</span><span class="kc">n</span><span class="err">d</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">pa</span><span class="kc">t</span><span class="err">h</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$datos_ventas&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">preserveNullA</span><span class="kc">n</span><span class="err">dEmp</span><span class="kc">t</span><span class="err">yArrays</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="err">)</span>
</code></pre></div>
<h2 id="36-actividades">3.6. Actividades</h2>
<h3 id="361-act_1">3.6.1. Act_1</h3>
<p>Vamos a trabajar con dos colecciones:
<a href="../profesores.json" target="_blank">profesores</a> y <a href="../asignaturas.json" target="_blank">asignaturas</a></p>
<p>Para importar los datos y subirlos a MongoDB Atlas podéis usar este comando:
<div class="highlight"><pre><span></span><code><span class="n">mongoimport</span> <span class="o">--</span><span class="n">uri</span> <span class="s1">&#39;mongodb+srv://USUARIO:CONTRASEÑA@CLUSTER/BASEDEDATOS?retryWrites=true&amp;w=majority&#39;</span> <span class="o">--</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;asignaturas&#39;</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;asignaturas.json&#39;</span>
</code></pre></div>
Estas son las consultas propuestas:</p>
<p><strong>Insertar, Modificar y Borrar</strong></p>
<ol>
<li>Listar todos los profesores  // db.profesores.find()</li>
<li>Insertar un profesor y una asignatura en la colección</li>
<li>Actualizar la asignatura del profesor que acabáis de insertar</li>
<li>Borrar el profesor que se acaba de insertar</li>
<li>Actualizar todas las edades de los profesores en una unidad</li>
<li>Usar upsert para añadir un nuevo profesor con nombre “Aitor”, en caso de que no lo encuentre, añade un campo “Personal” con valor ”Fijo”</li>
</ol>
<p><strong>Filtra, Ordenar y Contar mediante consultas</strong></p>
<ol>
<li>Listar los profesores mostrando solo los nombres</li>
<li>Ordenar por nombre de forma ascendente</li>
<li>Ordenar por nombre de forma descendente</li>
<li>Limitar a 2 una búsqueda general sobre la colección profesores</li>
<li>Limitar a 2 intercalando 1 salto entre resultados</li>
<li>Contar el número de profesores de la colección</li>
<li>Contar el número de profesores que se llaman juan</li>
</ol>
<p><strong>Selectores de consultas</strong></p>
<ol>
<li>Listar las asignaturas con 23 alumnos</li>
<li>Listar las asignaturas con 23 alumnos o más</li>
<li>Listar las asignaturas que imparte el profesor Juan</li>
<li>Listar las asignaturas que NO imparte el profesor Juan</li>
<li>Listar las asignaturas que imparten Juan o Laura </li>
<li>Listar las asignaturas que NO imparten ni Juan ni Laura </li>
</ol>
<h3 id="362-act_2">3.6.2. Act_2</h3>
<p>Vamos a trabajar con 4 colecciones:</p>
<ul>
<li><a href="../articulos.json" target="_blank">articulos</a> </li>
<li><a href="../inventario.json" target="_blank">inventario</a></li>
<li><a href="../productos.json" target="_blank">productos</a></li>
<li><a href="../calificaciones.json" target="_blank">calificaciones</a></li>
</ul>
<p><strong>Trabajar con textos</strong></p>
<ol>
<li>Buscar “backing” en la colección artículos</li>
<li>Buscar la frase completa “café con leche"</li>
<li>Realizar la misma consulta que la anterior pero teniendo en cuenta mayúsculas y minúsculas</li>
</ol>
<p><strong>Operadores con arrays</strong></p>
<ol>
<li>Buscar todos los registros que en etiquetas tengan cuaderno y libro.</li>
<li>Buscar los documentos con arrays de tamaño 5</li>
</ol>
<p><strong>Modificadores de actualización</strong></p>
<ol>
<li>Asignarle al producto con _id:1 un precio de 20 si el precio que tiene actualmente es menor</li>
<li>Multiplica por dos 2 el precio del producto _id:1</li>
</ol>
<p><strong>Modificadores de actualización de arrays</strong></p>
<ol>
<li>Eliminar el primer elemento del array de la colección de calificaciones para el alumno con id=1</li>
<li>Eliminar el último elemento de un array</li>
<li>Agregar la calificación 90 al array</li>
<li>Eliminar todos las “calis” coincidentes con 100 y 81 un array se usa pullAll y los valores a buscar se ponen entre corchetes.</li>
</ol>
<h3 id="363-act_3">3.6.3. Act_3</h3>
<p>Vamos a trabajar con una colección de <a href="../municipios.json" target="_blank">municipios</a> </p>
<ol>
<li>Muestra el total de varones y de mujeres en la misma consulta</li>
<li>Muestra la población de cada provincia (Provincia y Población total) en orden descendente</li>
<li>Muestra en orden descendente las provincias (provincia y número de poblaciones) con más de 20 de poblaciones cuya altitud sea mayor que 1000</li>
</ol>
<h3 id="364-act_4">3.6.4. Act_4</h3>
<p>Utilizando estas colecciones de <a href="../productos.json" target="_blank">productos</a> y <a href="../ventas.json" target="_blank">ventas</a> obten el importe total vendido de cada producto, indicando su nombre y descripión</p>
<details class="info">
<summary>Solución_1</summary>
<div class="highlight"><pre><span></span><code><span class="err">db.ve</span><span class="kc">ntas</span><span class="err">.aggrega</span><span class="kc">te</span><span class="err">(</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$lookup</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kc">fr</span><span class="err">om</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;productos&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">localField</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;producto_id&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="kc">f</span><span class="err">oreig</span><span class="kc">n</span><span class="err">Field</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_id&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">as</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;datos_producto&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$u</span><span class="kc">n</span><span class="err">wi</span><span class="kc">n</span><span class="err">d</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$datos_producto&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$group</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$producto_id&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="err">Nombre</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$datos_producto.nombre&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="err">Descripcio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$datos_producto.descripcion&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="err">To</span><span class="kc">tal</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$sum</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$total&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$projec</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="err">Nombre</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$_id.Nombre&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">Descripcio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$_id.Descripcion&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">Impor</span><span class="kc">te</span><span class="err">To</span><span class="kc">tal</span><span class="err">Ve</span><span class="kc">n</span><span class="err">dido</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$Total&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="err">)</span>
</code></pre></div>
</details>
<details class="info">
<summary>Solución_2 con left join. Incluye los articulos sin ventas</summary>
<div class="highlight"><pre><span></span><code><span class="err">db.produc</span><span class="kc">t</span><span class="err">os.aggrega</span><span class="kc">te</span><span class="err">(</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$lookup</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kc">fr</span><span class="err">om</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ventas&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">localField</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_id&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="kc">f</span><span class="err">oreig</span><span class="kc">n</span><span class="err">Field</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;producto_id&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">as</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;datos_ventas&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$u</span><span class="kc">n</span><span class="err">wi</span><span class="kc">n</span><span class="err">d</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">pa</span><span class="kc">t</span><span class="err">h</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$datos_ventas&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">preserveNullA</span><span class="kc">n</span><span class="err">dEmp</span><span class="kc">t</span><span class="err">yArrays</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$group</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="err">_id</span><span class="p">:</span><span class="s2">&quot;$id&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="err">Nombre</span><span class="p">:</span><span class="s2">&quot;$nombre&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="err">Descripcio</span><span class="kc">n</span><span class="err">Nombre</span><span class="p">:</span><span class="s2">&quot;$descripcion&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="err">To</span><span class="kc">tal</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="err">$sum</span><span class="w"> </span><span class="p">:</span><span class="s2">&quot;$datos_ventas.total&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">$projec</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="err">Nombre</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$_id.Nombre&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="err">Descripcio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$_id.Descripcion&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="err">Impor</span><span class="kc">te</span><span class="err">To</span><span class="kc">tal</span><span class="err">Ve</span><span class="kc">n</span><span class="err">dido</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$Total&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="err">)</span>
</code></pre></div>
</details>
<!-- Esto no será visible. [alumnos](Alu.xlsx){:target="_blank"} -->





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>